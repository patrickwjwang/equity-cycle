---
title: "STAT 222 - Feature Selection"
author: "Kenneth Chen"
format: html
editor: visual
---

# Recovery Stage

```{r}
#| message: false
#| echo: false
#| 
library(tidyverse)
library(stringr)
library(here)
library(stargazer)
recovery_df <- read_csv(here("data/processed", "recovery_factor_candidates.csv"))
```

## Stepwise Selection - Low Return

```{r}
#| output: false
#| echo: false
#| 
lm_df <- recovery_df %>%
    select(-Year_Week, -Phase)
n <- nrow(lm_df)
# Full model with all factors
full_mdl <- lm(
    `R1-RF` ~ . - `R2-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R1-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))

```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false
temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
recovery_low_mdl <- back_BIC_mdl
recovery_low_factors <- attributes(recovery_low_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(recovery_low_factors, collapse = ", ")))
```

## Stepwise Selection - Medium Return

```{r}
#| output: false
#| echo: false
#| 
# Full model with all factors
full_mdl <- lm(
    `R2-RF` ~ . - `R1-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R2-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))
```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
recovery_med_mdl <- back_AIC_mdl
recovery_med_factors <- attributes(recovery_med_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(recovery_med_factors, collapse = ", ")))
```

## Stepwise Selection - High Return

```{r}
#| output: false
#| echo: false
#| 
# Full model with all factors
full_mdl <- lm(
    `R3-RF` ~ . - `R1-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R3-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))

```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
recovery_high_mdl <- back_BIC_mdl
recovery_high_factors <- attributes(recovery_high_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(recovery_high_factors, collapse = ", ")))
```

# Expansion Stage

```{r}
#| message: false
#| echo: false
#| 
expansion_df <- read_csv(here("data/processed", "expansion_factor_candidates.csv"))
```

## Stepwise Selection - Low Return

```{r}
#| output: false
#| echo: false
#| 
lm_df <- expansion_df %>%
    select(-Year_Week, -Phase)
n <- nrow(lm_df)
# Full model with all factors
full_mdl <- lm(
    `R1-RF` ~ . - `R2-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R1-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))
```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
expansion_low_mdl <- back_BIC_mdl
expansion_low_factors <- attributes(expansion_low_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(expansion_low_factors, collapse = ", ")))
```

## Stepwise Selection - Medium Return

```{r}
#| output: false
#| echo: false
#| 
# Full model with all factors
full_mdl <- lm(
    `R2-RF` ~ . - `R1-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R2-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))
```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
expansion_med_mdl <- back_BIC_mdl
expansion_med_factors <- attributes(expansion_med_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(expansion_med_factors, collapse = ", ")))
```

## Stepwise Selection - High Return

```{r}
#| output: false
#| echo: false
#| 
# Full model with all factors
full_mdl <- lm(
    `R3-RF` ~ . - `R1-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R3-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))

```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
expansion_high_mdl <- back_BIC_mdl
expansion_high_factors <- attributes(expansion_high_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(expansion_high_factors, collapse = ", ")))
```

# Downturn Stage

```{r}
#| message: false
#| echo: false
#| 
downturn_df <- read_csv(here("data/processed", "downturn_factor_candidates.csv"))
```

## Stepwise Selection - Low Return

```{r}
#| output: false
#| echo: false
#| 
lm_df <- downturn_df %>%
    select(-Year_Week, -Phase)
n <- nrow(lm_df)
# Full model with all factors
full_mdl <- lm(
    `R1-RF` ~ . - `R2-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R1-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))
```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
downturn_low_mdl <- back_AIC_mdl
downturn_low_factors <- attributes(downturn_low_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(downturn_low_factors, collapse = ", ")))
```

## Stepwise Selection - Medium Return

```{r}
#| output: false
#| echo: false
#| 
# Full model with all factors
full_mdl <- lm(
    `R2-RF` ~ . - `R1-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R2-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))

```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
downturn_med_mdl <- forward_BIC_mdl
downturn_med_factors <- attributes(downturn_med_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(downturn_med_factors, collapse = ", ")))
```

## Stepwise Selection - High Return

```{r}
#| output: false
#| echo: false
#| 
# Full model with all factors
full_mdl <- lm(
    `R3-RF` ~ . - `R1-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R3-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))

```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
downturn_high_mdl <- forward_BIC_mdl
downturn_high_factors <- attributes(downturn_high_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(downturn_high_factors, collapse = ", ")))
```

# Depression Stage

```{r}
#| message: false
#| echo: false
#| 
depression_df <- read_csv(here("data/processed", "depression_factor_candidates.csv"))
```

## Stepwise Selection - Low Return

```{r}
#| output: false
#| echo: false
#| 
lm_df <- depression_df %>%
    select(-Year_Week, -Phase)
n <- nrow(lm_df)
# Full model with all factors
full_mdl <- lm(
    `R1-RF` ~ . - `R2-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R1-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))
```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false

temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
depression_low_mdl <- back_BIC_mdl
depression_low_factors <- attributes(depression_low_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(depression_low_factors, collapse = ", ")))
```

## Stepwise Selection - Medium Return

```{r}
#| output: false
#| echo: false
#| 
# Full model with all factors
full_mdl <- lm(
    `R2-RF` ~ . - `R1-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R2-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))

```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false
#| 
temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
depression_med_mdl <- back_BIC_mdl
depression_med_factors <- attributes(depression_med_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(depression_med_factors, collapse = ", ")))
```

## Stepwise Selection - High Return

```{r}
#| output: false
#| echo: false
#| 
# Full model with all factors
full_mdl <- lm(
    `R3-RF` ~ . - `R1-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
# Backward selection (AIC)
back_AIC_mdl <- step(full_mdl, direction = "backward")
# Backward selection (BIC)
back_BIC_mdl <- step(full_mdl, direction = "backward", k = log(n))

# Null model with no factors
null_mdl <- lm(
    `R3-RF` ~ 1,
    data = lm_df
)
# Forward selection (AIC)
forward_AIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward")
# Forward selection (BIC)
forward_BIC_mdl <- step(null_mdl, scope = list(lower = ~1, upper = full_mdl), direction = "forward", k = log(n))

```

The table below contains the following regression information for the following stepwise selections:

1. Backward AIC
2. Backward BIC
3. Forward AIC
4. Forward BIC

```{r, results = 'asis'}
#| echo: false
#| 
temp_sum <- summary(full_mdl)
print(paste0("R^2 for Full Model: ", round(temp_sum$r.squared, 3)))
print(paste0("Adjusted R^2 for Full Model: ", round(temp_sum$adj.r.squared, 3)))
# Selected model
stargazer(
    back_AIC_mdl,
    back_BIC_mdl,
    forward_AIC_mdl,
    forward_BIC_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')

# save factors of best model
depression_high_mdl <- back_AIC_mdl
depression_high_factors <- attributes(depression_high_mdl$terms)$term.labels
print(paste0("Selected Factors: ", paste0(depression_high_factors, collapse = ", ")))
```

# Final Factors

**Note**: I simply took the union of the selected factors for each return level. While this works fine for *Recovery* and *Expansion*, we will probably have to handpick the factors for *Downturn* and *Depression*.

## Recovery

```{r, results = 'asis'}
#| echo: false

targets <- c('R1-RF', 'R2-RF', 'R3-RF')
recovery_factors <- union(recovery_low_factors, union(recovery_med_factors, recovery_high_factors))
recovery_factors <- gsub("\`", "", recovery_factors)
# print(paste0("Recovery Factors: ", paste0(recovery_factors, collapse = ", ")))

lm_df <- recovery_df[c(targets, recovery_factors)]
recovery_low_mdl <- lm(
    `R1-RF` ~ . - `R3-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
recovery_med_mdl <- lm(
    `R2-RF` ~ . - `R1-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
recovery_high_mdl <- lm(
    `R3-RF` ~ . - `R1-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
stargazer(
    recovery_low_mdl,
    recovery_med_mdl,
    recovery_high_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')
```

## Expansion

```{r, results = 'asis'}
#| echo: false

targets <- c('R1-RF', 'R2-RF', 'R3-RF')
expansion_factors <- union(expansion_low_factors, union(expansion_med_factors, expansion_high_factors))
expansion_factors <- gsub("\`", "", expansion_factors)
# print(paste0("Expansion Factors: ", paste0(expansion_factors, collapse = ", ")))

lm_df <- expansion_df[c(targets, expansion_factors)]
expansion_low_mdl <- lm(
    `R1-RF` ~ . - `R3-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
expansion_med_mdl <- lm(
    `R2-RF` ~ . - `R1-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
expansion_high_mdl <- lm(
    `R3-RF` ~ . - `R1-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
stargazer(
    expansion_low_mdl,
    expansion_med_mdl,
    expansion_high_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')
```

## Downturn

```{r, results = 'asis'}
#| echo: false

targets <- c('R1-RF', 'R2-RF', 'R3-RF')
downturn_factors <- union(downturn_low_factors, union(downturn_med_factors, downturn_high_factors))
downturn_factors <- gsub("\`", "", downturn_factors)
# print(paste0("Downturn Factors: ", paste0(downturn_factors, collapse = ", ")))

lm_df <- downturn_df[c(targets, downturn_factors)]
downturn_low_mdl <- lm(
    `R1-RF` ~ . - `R3-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
downturn_med_mdl <- lm(
    `R2-RF` ~ . - `R1-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
downturn_high_mdl <- lm(
    `R3-RF` ~ . - `R1-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
stargazer(
    downturn_low_mdl,
    downturn_med_mdl,
    downturn_high_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')
```

## Depression

```{r, results = 'asis'}
#| echo: false

targets <- c('R1-RF', 'R2-RF', 'R3-RF')
depression_factors <- union(depression_low_factors, union(depression_med_factors, depression_high_factors))
depression_factors <- gsub("\`", "", depression_factors)
# print(paste0("Depression Factors: ", paste0(depression_factors, collapse = ", ")))

lm_df <- depression_df[c(targets, depression_factors)]
depression_low_mdl <- lm(
    `R1-RF` ~ . - `R3-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
depression_med_mdl <- lm(
    `R2-RF` ~ . - `R1-RF` - `R3-RF`, # Remove the other porftolio returns
    data = lm_df
)
depression_high_mdl <- lm(
    `R3-RF` ~ . - `R1-RF` - `R2-RF`, # Remove the other porftolio returns
    data = lm_df
)
stargazer(
    depression_low_mdl,
    depression_med_mdl,
    depression_high_mdl,
    type = 'html',
    header = FALSE,
    single.row = FALSE,
    no.space = FALSE, 
    column.sep.width = '3pt', 
    font.size = 'small')
```
